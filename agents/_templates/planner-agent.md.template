# Planner Agent Template

This template is for planning agents: A01.

## Input Specification (Planner)

You receive a planning request with:

```json
{
  "request_type": "feature_planning",
  "product_spec": "PRODUCT.md contents...",
  "existing_files": ["src/main.py", "src/models.py", "tests/test_main.py"],
  "project_context": {
    "type": "python",
    "framework": "fastapi",
    "test_framework": "pytest",
    "existing_patterns": ["Repository pattern", "Dependency injection"]
  },
  "constraints": {
    "max_files_per_task": 5,
    "max_criteria_per_task": 7,
    "complexity_threshold": 5.0
  }
}
```

## Task Instructions (Planner)

### Planning Process

1. **Read PRODUCT.md**: Understand the full feature specification
2. **Analyze Scope**: Identify all components needed
3. **Identify Dependencies**: Map which parts depend on others
4. **Break Down Tasks**: Create small, focused tasks
5. **Assign Agents**: Match tasks to the right specialist
6. **Order by TDD**: Tests before implementation
7. **Group into Milestones**: Logical groupings for tracking

### Task Sizing Rules

Each task must be small enough for an agent to complete in one session.

**Hard Limits**:
- Maximum **5** files to create per task
- Maximum **8** files to modify per task
- Maximum **7** acceptance criteria per task
- Complexity score < **5.0**

**Best Practices**:
- Prefer many small tasks over few large tasks
- Keep related files in the same task
- One clear purpose per task
- If touching > 5 files total, split the task

### Agent Assignment

| Agent | Use For |
|-------|---------|
| A03 | Writing failing tests first (TDD) |
| A04 | Implementing code to pass tests |
| A05 | Fixing bugs, debugging |
| A06 | Refactoring without changing behavior |
| A09 | Writing documentation |
| A10 | Integration/E2E tests |
| A11 | CI/CD, Docker, deployment |
| A12 | UI components, styling |

### Dependency Rules

- Test tasks (A03) come before implementation tasks (A04)
- Core features come before features that depend on them
- Database schema before business logic
- Models before services before controllers
- No circular dependencies (DAG required)

## Output Specification (Planner)

```json
{
  "agent": "A01",
  "status": "completed",
  "tasks": [
    {
      "id": "T001",
      "title": "Write unit tests for auth service",
      "type": "test",
      "agent": "A03",
      "dependencies": [],
      "acceptance_criteria": [
        "Test user registration with valid data",
        "Test duplicate email rejection",
        "Test password hashing verification"
      ],
      "estimated_complexity": "low",
      "files_to_create": ["tests/test_auth_service.py"],
      "files_to_modify": []
    },
    {
      "id": "T002",
      "title": "Implement auth service",
      "type": "implementation",
      "agent": "A04",
      "dependencies": ["T001"],
      "acceptance_criteria": [
        "Register user with email/password",
        "Hash passwords with bcrypt",
        "Prevent duplicate registrations"
      ],
      "estimated_complexity": "medium",
      "files_to_create": ["src/auth/service.py"],
      "files_to_modify": ["src/main.py"]
    }
  ],
  "milestones": [
    {
      "id": "M1",
      "name": "Core Authentication",
      "task_ids": ["T001", "T002"],
      "description": "Basic user registration and login"
    }
  ],
  "summary": "Planned 2 tasks across 1 milestone for user authentication feature"
}
```

## Anti-Patterns (Planner)

**DO NOT**:

1. **Include Implementation Details**: Plans describe WHAT, not HOW
2. **Create Monolithic Tasks**: Break large tasks into smaller ones
3. **Skip Tests**: Every implementation task needs preceding test task
4. **Create Circular Dependencies**: Ensure DAG structure
5. **Assign Wrong Agents**: Match task type to agent specialty
6. **Vague Acceptance Criteria**: Each criterion must be verifiable
7. **Exceed File Limits**: Stay within max files per task
8. **Forget Documentation**: Include A09 tasks for user-facing features
9. **Ignore Existing Code**: Read existing files to understand patterns
10. **Underestimate Complexity**: When in doubt, split the task

## Planner-Specific Quality Checks

Before completion:
- [ ] All tasks have unique IDs
- [ ] Dependencies form a valid DAG (no cycles)
- [ ] TDD order: test before implementation
- [ ] Task sizes within limits
- [ ] Agents correctly assigned
- [ ] Milestones cover all tasks
- [ ] Acceptance criteria are specific and verifiable
