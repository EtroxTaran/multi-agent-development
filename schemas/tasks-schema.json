{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Tasks",
  "description": "Schema for task breakdown output from task_breakdown_node",
  "type": "object",
  "required": ["tasks", "milestones", "created_at"],
  "properties": {
    "tasks": {
      "type": "array",
      "description": "List of implementation tasks",
      "items": {
        "type": "object",
        "required": ["id", "title", "status"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^T\\d+$",
            "description": "Task ID (e.g., T1, T2)"
          },
          "title": {
            "type": "string",
            "description": "Short task title (max 80 chars)"
          },
          "user_story": {
            "type": "string",
            "description": "User story in 'As a... I want... So that...' format"
          },
          "acceptance_criteria": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Acceptance criteria for this task"
          },
          "dependencies": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Task IDs this task depends on"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "failed", "blocked"],
            "description": "Current task status"
          },
          "priority": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "Task priority"
          },
          "milestone_id": {
            "type": ["string", "null"],
            "description": "ID of milestone this task belongs to"
          },
          "estimated_complexity": {
            "type": "string",
            "enum": ["low", "medium", "high"],
            "description": "Estimated implementation complexity"
          },
          "files_to_create": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Files to create for this task"
          },
          "files_to_modify": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Existing files to modify"
          },
          "test_files": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Test files for this task"
          },
          "attempts": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of implementation attempts"
          },
          "max_attempts": {
            "type": "integer",
            "minimum": 1,
            "default": 3,
            "description": "Maximum allowed attempts"
          },
          "linear_issue_id": {
            "type": ["string", "null"],
            "description": "Linear issue ID if integration enabled"
          },
          "implementation_notes": {
            "type": "string",
            "description": "Notes from implementation"
          },
          "error": {
            "type": ["string", "null"],
            "description": "Error message if task failed"
          }
        }
      }
    },
    "milestones": {
      "type": "array",
      "description": "List of task milestones/groups",
      "items": {
        "type": "object",
        "required": ["id", "name", "task_ids"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^M\\d+$",
            "description": "Milestone ID (e.g., M1, M2)"
          },
          "name": {
            "type": "string",
            "description": "Milestone name"
          },
          "description": {
            "type": "string",
            "description": "Milestone description"
          },
          "task_ids": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Task IDs in this milestone"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "failed", "blocked"],
            "description": "Milestone status"
          }
        }
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp when tasks were created"
    },
    "source": {
      "type": "string",
      "description": "Source node that created the tasks"
    }
  }
}
